<!DOCTYPE html>
<html>
<head>
<title>TRICK 2015で三位に入賞しました</title>
<style>
body {
  max-width: 960px;
  margin: 1em auto 3em;
  font-family: "Helvetica Neue", Helvetica, "ヒラギノ角ゴ ProN W3", "Hiragino Kaku Gothic ProN", "メイリオ", Meiryo, sans-serif;
  color: #333;
  line-height: 1.5;
}
a {
  color: #3366ee;
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}
h1 {
  font-size: 180%;
  font-weight: bold;
  border-bottom: 1px solid #ddd;
}
h2 {
  margin-top: 1.5em;
  font-size: 150%;
  font-weight: bold;
  border-bottom: 1px solid #ddd;
}
blockquote {
  padding: 0.5em 1em;
  background-color: #f8f8f8;
}
pre, code {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 80%;
  line-height: 1.1;
  background-color: #f8f8f8;
}
pre {
  padding: 1em;
}
code {
  padding: 0.1em 0.5em;
}
.nb {
  color: #0086b3;
}
.vg {
  color: #008080;
}
.sx, .s2, .si {
  color: #d14;
}
.sr {
  color: #009926;
}
.mi {
  color: #099;
}
.c1 {
  color: #999;
}
.k {
  font-weight: bold;
}
</style>
</head>
<body>
<h1>TRICK 2015で三位に入賞しました</h1>

<p><a href="https://github.com/tric/trick2015">TRICK 2015</a>というのは、意味不明なキモいコードを書くプログラミングコンテストです。やったぜ。<br>
審査員の方々、このようなわけのわからない代物を解読していただき本当にありがとうございました。<br>
栄えなき「Doubling amphisbaena award」を受賞したプログラムが、<a href="https://github.com/tric/trick2015/blob/master/monae/entry.rb">こちら</a>。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>          ;;  ;;          ;;  ;;
           ;;  ;;          ;;  ;;
        ;;eval$s        =%q[i=1#
         eval(%q[        xxxxxxxx
        xx  xxxx  xx    xx  xxxx  xx
         xx  xxxx  xx    xx  xxxx  xx
            xxxxxxxx        xxxxxxxx
             xxxxxxxx        xxxxxxxx
  xx  xx  xxxxxxxxxx  xx  xxxxxxxx
   j,  t,  p=0,[?;],"  ev  al$s=%qx
[#$s]".split*"";i,j,t=i-j,i+j,(x
 [b=?\s]*j.abs+t).map{|s|r=t.shix
ft  ||b;r.gsub!(?;){p.slice!0}if  $x
 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
     ust(r.size).gsub(b){r[$`.size]|x
  |b}}unti  l$  f;puts(t)#  xx  xx
   xxxxxxxx  xx  xxxxxxxxxx  xx  xx
xxxxxxxx        xxxxxxxx
 xxxxxxxx        xxxxxxxx
xx  xxxx  xx    xx  xxxx  xx
 xx  xxxx  xx    xx  xxxx  xx
    xxxxxxxx        x].gsub\
     /x.*|\s/        ,"")#];;
    ;;  ;;          ;;  ;;
     ;;  ;;          ;;  ;;
</pre></div></div>

<p>これを実行するとこのような出力を吐き出します。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>          ;;  ;;          ;;  ;;
           ;;  ;;          ;;  ;;
        ;;eval$s        =%q[i=1#
         eval(%q[        xxxxxxxx
        xx  xxxx  xx    xx  xxxx  xx
         xx  xxxx  xx    xx  xxxx  xx
            xxxxxxxx        xxxxxxxx
             xxxxxxxx        xxxxxxxx
  xx  xx  xxxxxxxxxx  xx  xxxxxxxx
   j,  t,  p=0,[?;],"  ev  al$s=%qx
[#$s]".split*"";i,j,t=i-j,i+j,(x
 [b=?\s]*j.abs+t).map{|s|r=t.shix
ft  ||b;r.gsub!(?;){p.slice!0}if  $x
 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
     ust(r.size).gsub(b){r[$`.size]|x
  |b}}unti  l$  f;puts(t)#;;xx;;xx        ;;  ;;
   xxxxxxxx  xx  xxxxxxxxxx;;xx;;xx        ;;  ;;
xxxxxxxx        xxxxxxxx;;eval$s        =%q[i=1#
 xxxxxxxx        xxxxxxxxeval(%q[        xxxxxxxx
xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
 xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
    xxxxxxxx        x].gsub\xxxxxxxx        xxxxxxxx
     /x.*|\s/        ,"")#];;xxxxxxxx        xxxxxxxx
    ;;  ;;        xx;;xx;;xxxxxxxxxx  xx  xxxxxxxx
     ;;  ;;        j,;;t,;;p=0,[?;],"  ev  al$s=%qx
                [#$s]".split*"";i,j,t=i-j,i+j,(x
                 [b=?\s]*j.abs+t).map{|s|r=t.shix
                ft  ||b;r.gsub!(?;){p.slice!0}if  $x
                 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                     ust(r.size).gsub(b){r[$`.size]|x
                  |b}}unti  l$  f;puts(t)#  xx  xx
                   xxxxxxxx  xx  xxxxxxxxxx  xx  xx
                xxxxxxxx        xxxxxxxx
                 xxxxxxxx        xxxxxxxx
                xx  xxxx  xx    xx  xxxx  xx
                 xx  xxxx  xx    xx  xxxx  xx
                    xxxxxxxx        x].gsub\
                     /x.*|\s/        ,"")#];;
                    ;;  ;;          ;;  ;;
                     ;;  ;;          ;;  ;;
</pre></div></div>

<p>少々図形が絡み合って見づらいですが、もともとのプログラムを、位置を変えて二回書き出したものになっています。<br>
実はこれもプログラムです。<br>
これを実行すると今度はこうなります。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>          ;;  ;;          ;;  ;;
           ;;  ;;          ;;  ;;
        ;;eval$s        =%q[i=1#
         eval(%q[        xxxxxxxx
        xx  xxxx  xx    xx  xxxx  xx
         xx  xxxx  xx    xx  xxxx  xx
            xxxxxxxx        xxxxxxxx
             xxxxxxxx        xxxxxxxx
  xx  xx  xxxxxxxxxx  xx  xxxxxxxx
   j,  t,  p=0,[?;],"  ev  al$s=%qx
[#$s]".split*"";i,j,t=i-j,i+j,(x
 [b=?\s]*j.abs+t).map{|s|r=t.shix
ft  ||b;r.gsub!(?;){p.slice!0}if  $x
 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
     ust(r.size).gsub(b){r[$`.size]|x
  |b}}unti  l$  f;puts(t)#;;xx;;xx        ;;  ;;
   xxxxxxxx  xx  xxxxxxxxxx;;xx;;xx        ;;  ;;
xxxxxxxx        xxxxxxxx;;eval$s        =%q[i=1#
 xxxxxxxx        xxxxxxxxeval(%q[        xxxxxxxx
xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
 xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
    xxxxxxxx        x].gsub\xxxxxxxx        xxxxxxxx
     /x.*|\s/        ,"")#];;xxxxxxxx        xxxxxxxx
    ;;  ;;        xx;;xx;;xxxxxxxxxx  xx  xxxxxxxx
     ;;  ;;        j,;;t,;;p=0,[?;],"  ev  al$s=%qx
                [#$s]".split*"";i,j,t=i-j,i+j,(x
                 [b=?\s]*j.abs+t).map{|s|r=t.shix
                ft  ||b;r.gsub!(?;){p.slice!0}if  $x
                 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                     ust(r.size).gsub(b){r[$`.size]|x
          ;;  ;;  |b}}unti;;l$;;f;puts(t)#  xx  xx
           ;;  ;;  xxxxxxxx;;xx;;xxxxxxxxxx  xx  xx
        ;;eval$sxxxxxxxx=%q[i=1#xxxxxxxx
         eval(%q[xxxxxxxxxxxxxxxxxxxxxxxx
        xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx
         xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx
            xxxxxxxxxxxxxxxxxxxxxxxxx].gsub\
             xxxxxxxx/x.*|\s/xxxxxxxx,"")#];;
  xx  xx  xxxxxxxxxx;;xx;;xxxxxxxx  ;;  ;;
   j,  t,  p=0,[?;],";;ev;;al$s=%qx  ;;  ;;
[#$s]".split*"";i,j,t=i-j,i+j,(x
 [b=?\s]*j.abs+t).map{|s|r=t.shix
ft  ||b;r.gsub!(?;){p.slice!0}if  $x
 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
     ust(r.size).gsub(b){r[$`.size]|x
  |b}}unti  l$  f;puts(t)#;;xx;;xx        ;;  ;;
   xxxxxxxx  xx  xxxxxxxxxx;;xx;;xx        ;;  ;;
xxxxxxxx        xxxxxxxx;;eval$s        =%q[i=1#
 xxxxxxxx        xxxxxxxxeval(%q[        xxxxxxxx
xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
 xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
    xxxxxxxx        x].gsub\xxxxxxxx        xxxxxxxx
     /x.*|\s/        ,"")#];;xxxxxxxx        xxxxxxxx
    ;;  ;;        xx;;xx;;xxxxxxxxxx  xx  xxxxxxxx
     ;;  ;;        j,;;t,;;p=0,[?;],"  ev  al$s=%qx
                [#$s]".split*"";i,j,t=i-j,i+j,(x
                 [b=?\s]*j.abs+t).map{|s|r=t.shix
                ft  ||b;r.gsub!(?;){p.slice!0}if  $x
                 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                     ust(r.size).gsub(b){r[$`.size]|x
                  |b}}unti  l$  f;puts(t)#  xx  xx
                   xxxxxxxx  xx  xxxxxxxxxx  xx  xx
                xxxxxxxx        xxxxxxxx
                 xxxxxxxx        xxxxxxxx
                xx  xxxx  xx    xx  xxxx  xx
                 xx  xxxx  xx    xx  xxxx  xx
                    xxxxxxxx        x].gsub\
                     /x.*|\s/        ,"")#];;
                    ;;  ;;          ;;  ;;
                     ;;  ;;          ;;  ;;
</pre></div></div>

<p>また倍に増えました。<br>
さらに実行するとこう。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>                                          ;;  ;;          ;;  ;;
                                           ;;  ;;          ;;  ;;
                                        ;;eval$s        =%q[i=1#
                                         eval(%q[        xxxxxxxx
                                        xx  xxxx  xx    xx  xxxx  xx
                                         xx  xxxx  xx    xx  xxxx  xx
                                            xxxxxxxx        xxxxxxxx
                                             xxxxxxxx        xxxxxxxx
                                  xx  xx  xxxxxxxxxx  xx  xxxxxxxx
                                   j,  t,  p=0,[?;],"  ev  al$s=%qx
                                [#$s]".split*"";i,j,t=i-j,i+j,(x
                                 [b=?\s]*j.abs+t).map{|s|r=t.shix
                                ft  ||b;r.gsub!(?;){p.slice!0}if  $x
                                 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                                     ust(r.size).gsub(b){r[$`.size]|x
                                  |b}}unti  l$  f;puts(t)#;;xx;;xx        ;;  ;;
                                   xxxxxxxx  xx  xxxxxxxxxx;;xx;;xx        ;;  ;;
                                xxxxxxxx        xxxxxxxx;;eval$s        =%q[i=1#
                                 xxxxxxxx        xxxxxxxxeval(%q[        xxxxxxxx
                                xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
                                 xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
                                    xxxxxxxx        x].gsub\xxxxxxxx        xxxxxxxx
                                     /x.*|\s/        ,"")#];;xxxxxxxx        xxxxxxxx
                                    ;;  ;;        xx;;xx;;xxxxxxxxxx  xx  xxxxxxxx
                                     ;;  ;;        j,;;t,;;p=0,[?;],"  ev  al$s=%qx
                                                [#$s]".split*"";i,j,t=i-j,i+j,(x
                                                 [b=?\s]*j.abs+t).map{|s|r=t.shix
                                                ft  ||b;r.gsub!(?;){p.slice!0}if  $x
                                                 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                                                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                                                     ust(r.size).gsub(b){r[$`.size]|x
          ;;  ;;          ;;  ;;          ;;  ;;  |b}}unti;;l$;;f;puts(t)#  xx  xx
           ;;  ;;          ;;  ;;          ;;  ;;  xxxxxxxx;;xx;;xxxxxxxxxx  xx  xx
        ;;eval$s        =%q[i=1#        ;;eval$sxxxxxxxx=%q[i=1#xxxxxxxx
         eval(%q[        xxxxxxxx        eval(%q[xxxxxxxxxxxxxxxxxxxxxxxx
        xx  xxxx  xx    xx  xxxx  xx    xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx
         xx  xxxx  xx    xx  xxxx  xx    xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx
            xxxxxxxx        xxxxxxxx        xxxxxxxxxxxxxxxxxxxxxxxxx].gsub\
             xxxxxxxx        xxxxxxxx        xxxxxxxx/x.*|\s/xxxxxxxx,"")#];;
  xx  xx  xxxxxxxxxx  xx  xxxxxxxxxx  xx  xxxxxxxxxx;;xx;;xxxxxxxx  ;;  ;;
   j,  t,  p=0,[?;],"  ev  al$s=%qxj,  t,  p=0,[?;],";;ev;;al$s=%qx  ;;  ;;
[#$s]".split*"";i,j,t=i-j,i+j,(x[#$s]".split*"";i,j,t=i-j,i+j,(x
 [b=?\s]*j.abs+t).map{|s|r=t.shix[b=?\s]*j.abs+t).map{|s|r=t.shix
ft  ||b;r.gsub!(?;){p.slice!0}ifft$x||b;r.gsub!(?;){p.slice!0}if  $x
 f|  |=p&gt;p=p.center(i*i+j*j,?;);rf|,x|=p&gt;p=p.center(i*i+j*j,?;);r  ,x
    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljxs=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
     ust(r.size).gsub(b){r[$`.size]|xust(r.size).gsub(b){r[$`.size]|x
  |b}}unti  l$  f;puts(t)#;;xx;;xx|b}}unti;;l$;;f;puts(t)#;;xx;;xx        ;;  ;;
   xxxxxxxx  xx  xxxxxxxxxx;;xx;;xxxxxxxxxx;;xx;;xxxxxxxxxx;;xx;;xx        ;;  ;;
xxxxxxxx        xxxxxxxx;;eval$sxxxxxxxx=%q[i=1#xxxxxxxx;;eval$s        =%q[i=1#
 xxxxxxxx        xxxxxxxxeval(%q[xxxxxxxxxxxxxxxxxxxxxxxxeval(%q[        xxxxxxxx
xx  xxxx  xx    xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx    xx  xxxx  xx
 xx  xxxx  xx    xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx    xx  xxxx  xx
    xxxxxxxx        x].gsub\xxxxxxxxxxxxxxxxxxxxxxxxx].gsub\xxxxxxxx        xxxxxxxx
     /x.*|\s/        ,"")#];;xxxxxxxx/x.*|\s/xxxxxxxx,"")#];;xxxxxxxx        xxxxxxxx
    ;;  ;;        xx;;xx;;xxxxxxxxxx;;xx;;xxxxxxxxxx;;xx;;xxxxxxxxxx  xx  xxxxxxxx
     ;;  ;;        j,;;t,;;p=0,[?;],";;ev;;al$s=%qxj,;;t,;;p=0,[?;],"  ev  al$s=%qx
                [#$s]".split*"";i,j,t=i-j,i+j,(x[#$s]".split*"";i,j,t=i-j,i+j,(x
                 [b=?\s]*j.abs+t).map{|s|r=t.shix[b=?\s]*j.abs+t).map{|s|r=t.shix
                ft  ||b;r.gsub!(?;){p.slice!0}ifft$x||b;r.gsub!(?;){p.slice!0}if  $x
                 f|  |=p&gt;p=p.center(i*i+j*j,?;);rf|,x|=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljxs=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                     ust(r.size).gsub(b){r[$`.size]|xust(r.size).gsub(b){r[$`.size]|x
          ;;  ;;  |b}}unti;;l$;;f;puts(t)#  xx  xx|b}}unti  l$  f;puts(t)#  xx  xx
           ;;  ;;  xxxxxxxx;;xx;;xxxxxxxxxx  xx  xxxxxxxxxx  xx  xxxxxxxxxx  xx  xx
        ;;eval$sxxxxxxxx=%q[i=1#xxxxxxxx        xxxxxxxx        xxxxxxxx
         eval(%q[xxxxxxxxxxxxxxxxxxxxxxxx        xxxxxxxx        xxxxxxxx
        xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx    xx  xxxx  xx    xx  xxxx  xx
         xx  xxxxxxxxxxxxxxxxxxxxxxxxxxxx  xx    xx  xxxx  xx    xx  xxxx  xx
            xxxxxxxxxxxxxxxxxxxxxxxxx].gsub\        xxxxxxxx        x].gsub\
             xxxxxxxx/x.*|\s/xxxxxxxx,"")#];;        /x.*|\s/        ,"")#];;
  xx  xx  xxxxxxxxxx;;xx;;xxxxxxxx  ;;  ;;          ;;  ;;          ;;  ;;
   j,  t,  p=0,[?;],";;ev;;al$s=%qx  ;;  ;;          ;;  ;;          ;;  ;;
[#$s]".split*"";i,j,t=i-j,i+j,(x
 [b=?\s]*j.abs+t).map{|s|r=t.shix
ft  ||b;r.gsub!(?;){p.slice!0}if  $x
 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
     ust(r.size).gsub(b){r[$`.size]|x
  |b}}unti  l$  f;puts(t)#;;xx;;xx        ;;  ;;
   xxxxxxxx  xx  xxxxxxxxxx;;xx;;xx        ;;  ;;
xxxxxxxx        xxxxxxxx;;eval$s        =%q[i=1#
 xxxxxxxx        xxxxxxxxeval(%q[        xxxxxxxx
xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
 xx  xxxx  xx    xx  xxxxxxxxxxxx  xx    xx  xxxx  xx
    xxxxxxxx        x].gsub\xxxxxxxx        xxxxxxxx
     /x.*|\s/        ,"")#];;xxxxxxxx        xxxxxxxx
    ;;  ;;        xx;;xx;;xxxxxxxxxx  xx  xxxxxxxx
     ;;  ;;        j,;;t,;;p=0,[?;],"  ev  al$s=%qx
                [#$s]".split*"";i,j,t=i-j,i+j,(x
                 [b=?\s]*j.abs+t).map{|s|r=t.shix
                ft  ||b;r.gsub!(?;){p.slice!0}if  $x
                 f|  |=p&gt;p=p.center(i*i+j*j,?;);r  ,x
                    s=[s,r]if(i*j&lt;0);(b*i.abs+s).ljx
                     ust(r.size).gsub(b){r[$`.size]|x
                  |b}}unti  l$  f;puts(t)#  xx  xx
                   xxxxxxxx  xx  xxxxxxxxxx  xx  xx
                xxxxxxxx        xxxxxxxx
                 xxxxxxxx        xxxxxxxx
                xx  xxxx  xx    xx  xxxx  xx
                 xx  xxxx  xx    xx  xxxx  xx
                    xxxxxxxx        x].gsub\
                     /x.*|\s/        ,"")#];;
                    ;;  ;;          ;;  ;;
                     ;;  ;;          ;;  ;;
</pre></div></div>

<p>際限なく倍々に増えていきます。</p>

<h2>元ネタ</h2>

<p>というわけで、コンセプトは自分自身を複製しながらAAで巨大なフラクタルを形成するというプログラムでした。<br>
フラクタルの名前は<a href="https://en.wikipedia.org/wiki/Dragon_curve#Twindragon">Twin dragon</a>といい、（もう少し）有名な<a href="https://en.wikipedia.org/wiki/Dragon_curve">Dragon curve</a>というフラクタルを二つ重ねたものになっています。<br>
1ピクセルの点から初めてどんどん倍々にコピペしていけばMS Paintでも簡単に手作業で描くことができるかわいいやつです。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>                                   ##         ##  ##
                        ##          ##         ##  ##
#  -&gt;  ##  -&gt;  ##   -&gt;   ##  -&gt;  ####   -&gt;  ########   -&gt; ...
                ##      ##        ####       ########
                         ##      ##         ##  ##
                                  ##         ##  ##
</pre></div></div>

<p>プログラムの説明文にはこんなことを書きました。</p>

<blockquote>
<p>A simple quine which prints itself twice on a slightly complex base.</p>
</blockquote>

<p>quine というのは自分自身を書き出すプログラムの総称です。<br>
「simpleなquine」に対比させて「slightly complex base（少しばかり複雑な基礎）」 と書きましたが、<br>
これはダブルミーニングで、<a href="https://en.wikipedia.org/wiki/Complex_base_systems#Base_.E2.88.921.C2.B1i">complex base（複素数の底）</a>とかけています。<br>
おなじみの10進法や2進法ではなく複素数z=1+iを記数法の底として使い、z進法でn桁以下の数を集めて図示するとTwin dragonの形になる、ということにちなんでいます。</p>

<p>ついでに<a href="https://ja.wikipedia.org/wiki/%E5%8D%9A%E7%89%A9%E8%AA%8C">プリニウスの博物誌</a>から以下を引用して添えておきました。<br>
ありとあらゆる動植物を非実在のものも含めて大量に陳列している書物の中で、いろいろな蛇を紹介している章からです。</p>

<blockquote>
<p>geminum caput amphisbaenae, hoc est et a cauda, tamquam parum esset uno ore fundi venenum. aliis squamas esse, aliis picturas, omnibus exitiale virus.</p>

<p>— GAIUS PLINIUS SECUNDUS, Naturalis Historia 8.85.1</p>
</blockquote>

<p>（……またアンフィスバエナという種は二つの頭、つまり尻尾にもう一つの頭を持ち、まるで一つの口では毒液を出し足りぬとでも言いたげである。これらの蛇のいくらかは鱗を、また別のものはまだらの皮膚を持つが、いずれも致死毒を所有する。）</p>

<p>「双子の龍」を「双頭の蛇」に見立てていますが、着目したのはvirus、ラテン語で毒液という単語。<br>
これはもちろん日常語になった「ウイルス」の語源です。<br>
自分自身を複製し際限なく増殖していくプログラムにはまことふさわしい語ではないでしょうか。</p>

<p>というのは建前で、<a href="http://d.hatena.ne.jp/ku-ma-me/20121018/p2">賞の名前を審査員に代わって考えてあげておくと受賞しやすい</a>という都市伝説の遂行が目的でした。<br>
Most complexとか、Most viralとかそういうの。<br>
伝わったかどうかはまったく定かではありませんが……</p>

<h2>プログラムの解説</h2>

<p>実装方法はもう完全に伝説的名著<a href="http://mame.github.io/trance-book/">あなたの知らない超絶技巧プログラミングの世界</a>からテクニックをパクりまくっています、ので先にこれを購入して完読しておけば以下の説明は不要でしょう。</p>

<p>プログラムはだいたい三層からなっています。外側から解説します。<br>
まずは一番外のガワ。</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="nb">eval</span> <span class="vg">$s</span> <span class="o">=</span> <span class="sx">%q[ ... #</span>
<span class="sx">...</span>
<span class="sx">... # ]</span>
</pre></div></div>

<p>中のプログラム文字列を変数に代入しつつ<code>eval</code>するおなじみのテクニックです、が一つ注意することがあり、<br>
自分自身を複製していく中で4段階目に達するとこの部分が以下のように横に重なってしまいます。</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="nb">eval</span> <span class="vg">$s</span> <span class="o">=</span> <span class="sx">%q[ ... # eval $s = %q[ ... #</span>
<span class="sx">...</span>
<span class="sx">... # ] ... # ]</span>
</pre></div></div>

<p>Rubyの謎仕様、入れ子にできる文字列リテラル<code>%q[...]</code>を駆使したおかげでうまいこと構文エラーにならずに回避できています。<br>
コメントアウトしない場合でも連続で<code>eval</code>できて楽しかったのですが、せっかく保存した<code>$s</code>がどんどん短くなっていくのでやめました。</p>

<p>二層目ではまた、中の文字列を各行<code>x</code>という文字以降と空白を削って一行のプログラムに連結してから<code>eval</code>しています。</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="nb">eval</span><span class="p">(</span><span class="sx">%q[</span>
<span class="sx">...</span>
<span class="sx">]</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/x.*|\s/</span><span class="p">,</span><span class="s2">""</span><span class="p">))</span>
</pre></div></div>

<p>これもプログラムが成長して横に並んだ時に余計な文字が入らないようにするためです。<br>
中のプログラムの最後は<code>#</code>で終えてあるので、以降の文字もすべてコメントアウトされて無視されます。</p>

<p>というわけで、三層目、ここが本当に自分自身を二回出力している部分です（<code>i=1</code>はスペースの都合上先に実行しておきましたが）。</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="nb">p</span> <span class="o">=</span> <span class="s2">"eval$s=%q[</span><span class="si">#$s</span><span class="s2">]"</span><span class="o">.</span><span class="n">split</span><span class="o">*</span><span class="s2">""</span>

<span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">[</span><span class="s2">";"</span><span class="o">]</span>

<span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">,(</span><span class="o">[</span><span class="s2">""</span><span class="o">]*</span><span class="n">j</span><span class="o">.</span><span class="n">abs</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">shift</span> <span class="o">||</span> <span class="s2">""</span>
  <span class="n">r</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="s2">";"</span><span class="p">)</span> <span class="p">{</span> <span class="nb">p</span><span class="o">.</span><span class="n">slice!</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">}</span> <span class="k">if</span> <span class="vg">$f</span> <span class="o">||</span> <span class="o">=</span> <span class="nb">p</span> <span class="o">&gt;</span> <span class="nb">p</span> <span class="o">=</span> <span class="nb">p</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="s2">";"</span><span class="p">)</span>
  <span class="n">r</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span><span class="n">r</span> <span class="k">if</span> <span class="n">i</span><span class="o">*</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span>
  <span class="p">(</span><span class="s2">" "</span><span class="o">*</span><span class="n">i</span><span class="o">.</span><span class="n">abs</span><span class="o">+</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span> <span class="p">{</span> <span class="n">r</span><span class="o">[</span><span class="vg">$`</span><span class="o">.</span><span class="n">size</span><span class="o">]</span> <span class="o">||</span> <span class="s2">" "</span> <span class="p">}</span>
<span class="p">}</span> <span class="k">until</span> <span class="vg">$f</span>

<span class="nb">puts</span> <span class="n">t</span>
</pre></div></div>

<p>まず最初に保存しておいた<code>$s</code>からもともとのプログラムを（前後の<code>;</code>を除き）<code>p</code>として復元しておきます。<br>
<code>i,j</code>にコピーするときに移動させる距離、<code>t</code>に出力すべきAAを入れておいて、これらをループで成長させ、<br>
最後の一歩手前でAAに<code>p</code>を流し込んで目的の出力を得ています。</p>

<p>ここの文は二つの文字列を空白を埋めて合成しています。</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="n">s</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span> <span class="p">{</span> <span class="n">r</span><span class="o">[</span><span class="vg">$`</span><span class="o">.</span><span class="n">size</span><span class="o">]</span> <span class="o">||</span> <span class="s2">" "</span> <span class="p">}</span>
<span class="c1"># s = "  AA    AA"</span>
<span class="c1"># t = "B   B B   BB"</span>
<span class="c1">#  =&gt; "B AAB B AABB"</span>
</pre></div></div>

<p><code>gsub</code>で空白にマッチさせるとグローバル変数<code>$`</code>にはその直前までの文字列が入るので、<code>size</code>を見れば空白の位置がわかるわけです。</p>

<p>また<a href="http://www.slideshare.net/mametter/trick2015-results#p54">審査員の方にもお気に入りにしていただいた</a>この部分</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="vg">$f</span> <span class="o">||</span> <span class="o">=</span> <span class="nb">p</span> <span class="o">&gt;</span> <span class="nb">p</span> <span class="o">=</span> <span class="nb">p</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="s2">";"</span><span class="p">)</span>
</pre></div></div>

<p>もう少しわかりやすく書くとこうなって</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="k">unless</span> <span class="vg">$f</span>
  <span class="n">length</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="o">*</span><span class="n">j</span> <span class="c1">#空白を除いたAAの文字列の長さ（複素数の絶対値！）</span>
  <span class="n">p2</span> <span class="o">=</span> <span class="nb">p</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="s2">";"</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">p</span> <span class="o">!=</span> <span class="n">p2</span>
    <span class="nb">p</span> <span class="o">=</span> <span class="n">p2</span>
    <span class="vg">$f</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div>

<p>ループの終了条件<code>$f</code>の判定と<code>;</code>を前後に補ってプログラムの復元を完成させる作業を同時にこなしているわけです。</p>

<h2>あとがき</h2>

<p>これを思いついてから基盤部分をほぼ完成させるまでにだいたい3~4日でしたが、<br>
プログラムのサイズを半分（128文字）に減らそうとして努力を無駄にし続ける作業にその後二週間くらいかかりました。<br>
おかげでAAとしてきれいにまとまる短さにはなりましたが、ゴルフ力が足りなかった。<br>
ぜひとも、この跡を引き継いでくれる方を募集しています。</p>

<p>とりあえずこれは</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="n">t</span><span class="o">=[</span><span class="sc">?;</span><span class="o">]</span>
</pre></div></div>

<p>こう書くと一文字減らせることを発見しましたが</p>

<div class="code-frame" data-lang="rb"><div class="highlight"><pre><span class="n">t</span><span class="o">=*</span><span class="sc">?;</span>
</pre></div></div>

<p>まったく意味が分からない。なんだこれは。</p>
</body>
</html>
